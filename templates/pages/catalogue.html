{% extends "base.html" %}

{% block title %}Catalogue - Yaad{% endblock %}

{% block content %}
<div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <!-- Header -->
    <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4 mb-8">
        <div>
            <h1 class="text-3xl font-bold text-white">Catalogue</h1>
            <p class="text-dark-400 mt-1">{{ total }} media{{ 's' if total != 1 else '' }} in your library</p>
        </div>
        <a href="/add"
           class="inline-flex items-center justify-center px-4 py-2 bg-primary-600 hover:bg-primary-700 text-white font-medium rounded-lg transition-colors">
            <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"/>
            </svg>
            Add Media
        </a>
    </div>

    <!-- View Tabs -->
    <div class="flex gap-2 mb-4">
        <a href="/catalogue{% if current_type %}?type={{ current_type }}{% endif %}"
           class="px-4 py-2 rounded-lg font-medium transition-colors {% if not show_incomplete %}bg-primary-600 text-white{% else %}bg-dark-800 text-dark-300 hover:bg-dark-700{% endif %}">
            All Media
        </a>
        {% if incomplete_count > 0 %}
        <a href="/catalogue?incomplete=1{% if current_type %}&type={{ current_type }}{% endif %}"
           class="px-4 py-2 rounded-lg font-medium transition-colors flex items-center gap-2 {% if show_incomplete %}bg-orange-600 text-white{% else %}bg-dark-800 text-dark-300 hover:bg-dark-700{% endif %}">
            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"/>
            </svg>
            Incomplete
            <span class="px-2 py-0.5 bg-orange-500/30 rounded-full text-xs">{{ incomplete_count }}</span>
        </a>
        {% endif %}
    </div>

    <!-- Filters -->
    <div class="bg-dark-900 rounded-xl border border-dark-800 p-4 mb-6">
        <form method="get" class="flex flex-col sm:flex-row gap-4">
            {% if show_incomplete %}
            <input type="hidden" name="incomplete" value="1">
            {% endif %}
            <!-- Search -->
            <div class="flex-1">
                <input type="text"
                       name="search"
                       value="{{ search }}"
                       placeholder="Search by title..."
                       class="w-full bg-dark-800 border border-dark-700 rounded-lg px-4 py-2 text-dark-100 placeholder-dark-500 focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-transparent">
            </div>

            <!-- Type filter -->
            <select name="type"
                    class="bg-dark-800 border border-dark-700 rounded-lg px-4 py-2 text-dark-100 focus:outline-none focus:ring-2 focus:ring-primary-500">
                <option value="">All Types</option>
                <option value="film" {% if current_type == 'film' %}selected{% endif %}>Films</option>
                <option value="series" {% if current_type == 'series' %}selected{% endif %}>Series</option>
                <option value="book" {% if current_type == 'book' %}selected{% endif %}>Books</option>
                <option value="youtube" {% if current_type == 'youtube' %}selected{% endif %}>Videos</option>
                <option value="podcast" {% if current_type == 'podcast' %}selected{% endif %}>Podcasts</option>
                <option value="show" {% if current_type == 'show' %}selected{% endif %}>Shows</option>
            </select>

            <!-- Status filter (hidden when showing incomplete) -->
            {% if not show_incomplete %}
            <select name="status"
                    class="bg-dark-800 border border-dark-700 rounded-lg px-4 py-2 text-dark-100 focus:outline-none focus:ring-2 focus:ring-primary-500">
                <option value="">All Status</option>
                <option value="to_consume" {% if current_status == 'to_consume' %}selected{% endif %}>To Watch/Read</option>
                <option value="in_progress" {% if current_status == 'in_progress' %}selected{% endif %}>In Progress</option>
                <option value="finished" {% if current_status == 'finished' %}selected{% endif %}>Finished</option>
                <option value="abandoned" {% if current_status == 'abandoned' %}selected{% endif %}>Abandoned</option>
            </select>
            {% endif %}

            <button type="submit"
                    class="px-4 py-2 bg-dark-700 hover:bg-dark-600 text-white rounded-lg transition-colors">
                Filter
            </button>

            {% if search or current_type or current_status %}
            <a href="/catalogue{% if show_incomplete %}?incomplete=1{% endif %}"
               class="px-4 py-2 text-dark-400 hover:text-white transition-colors">
                Clear
            </a>
            {% endif %}
        </form>
    </div>

    <!-- Media Grid -->
    {% if media_list %}
    <div class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-6 gap-4">
        {% for media in media_list %}
        <a href="/media/{{ media.id }}" class="group">
            <div class="bg-dark-900 rounded-lg border border-dark-800 overflow-hidden hover:border-primary-500 transition-colors">
                <!-- Cover - Adaptive aspect ratio based on media type -->
                <div class="{% if media.type.value in ['youtube', 'podcast'] %}aspect-video{% else %}aspect-[2/3]{% endif %} bg-dark-800 relative">
                    {% if media.cover_url %}
                    <img src="{{ media.cover_url }}"
                         alt="{{ media.title }}"
                         class="w-full h-full object-cover media-cover"
                         loading="lazy">
                    {% else %}
                    <!-- Letter placeholder with type-specific gradient -->
                    <div class="w-full h-full flex items-center justify-center
                        {% if media.type.value == 'film' %}bg-gradient-to-br from-blue-600 to-blue-800
                        {% elif media.type.value == 'series' %}bg-gradient-to-br from-cyan-600 to-cyan-800
                        {% elif media.type.value == 'book' %}bg-gradient-to-br from-green-600 to-green-800
                        {% elif media.type.value == 'youtube' %}bg-gradient-to-br from-red-600 to-red-800
                        {% elif media.type.value == 'podcast' %}bg-gradient-to-br from-purple-600 to-purple-800
                        {% elif media.type.value == 'show' %}bg-gradient-to-br from-pink-600 to-pink-800
                        {% else %}bg-gradient-to-br from-primary-600 to-primary-800{% endif %}">
                        <span class="text-4xl font-bold text-white/90">{{ media.title[0]|upper }}</span>
                    </div>
                    {% endif %}

                    <!-- Type badge (top left) -->
                    <div class="absolute top-2 left-2">
                        {% if media.type.value == 'film' %}
                        <span class="px-2 py-1 bg-blue-500/80 text-xs font-medium rounded text-white">Film</span>
                        {% elif media.type.value == 'series' %}
                        <span class="px-2 py-1 bg-cyan-500/80 text-xs font-medium rounded text-white">Series</span>
                        {% elif media.type.value == 'book' %}
                        <span class="px-2 py-1 bg-green-500/80 text-xs font-medium rounded text-white">Book</span>
                        {% elif media.type.value == 'youtube' %}
                        <span class="px-2 py-1 bg-red-500/80 text-xs font-medium rounded text-white">Video</span>
                        {% elif media.type.value == 'podcast' %}
                        <span class="px-2 py-1 bg-purple-500/80 text-xs font-medium rounded text-white">Podcast</span>
                        {% elif media.type.value == 'show' %}
                        <span class="px-2 py-1 bg-pink-500/80 text-xs font-medium rounded text-white">Show</span>
                        {% endif %}
                    </div>

                    <!-- Status badge (top right) -->
                    <div class="absolute top-2 right-2 flex flex-col gap-1 items-end">
                        {% if not media.is_complete %}
                        <span class="px-2 py-1 bg-orange-500/90 text-xs font-medium rounded text-white flex items-center gap-1" title="Missing: {{ media.missing_fields | join(', ') }}">
                            <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01"/>
                            </svg>
                            Incomplete
                        </span>
                        {% endif %}
                        {% if media.status.value == 'in_progress' %}
                        <span class="px-2 py-1 bg-yellow-500/80 text-xs font-medium rounded text-white">In Progress</span>
                        {% elif media.status.value == 'finished' %}
                        <span class="px-2 py-1 bg-green-600/80 text-xs font-medium rounded text-white">Finished</span>
                        {% endif %}
                    </div>

                    <!-- Rating -->
                    {% if media.rating %}
                    <div class="absolute bottom-2 left-2 flex items-center bg-dark-900/80 px-2 py-1 rounded">
                        <svg class="w-4 h-4 text-yellow-400 mr-1" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"/>
                        </svg>
                        <span class="text-sm text-white">{{ media.rating }}/5</span>
                    </div>
                    {% endif %}
                </div>

                <!-- Info -->
                <div class="p-3">
                    <h3 class="text-sm font-medium text-white line-clamp-2 group-hover:text-primary-400 transition-colors">
                        {{ media.title }}
                    </h3>
                    <p class="text-xs text-dark-400 mt-1">
                        {% if media.year %}{{ media.year }}{% endif %}
                        {% if media.year and media.duration_minutes %} &bull; {% endif %}
                        {% if media.duration_minutes %}{{ media.duration_minutes | format_duration }}{% endif %}
                        {% if media.page_count %}{{ media.page_count }} pages{% endif %}
                    </p>
                    {% if show_incomplete and media.missing_fields %}
                    <p class="text-xs text-orange-400 mt-1 line-clamp-1">
                        Missing: {{ media.missing_fields | join(', ') }}
                    </p>
                    {% endif %}
                </div>
            </div>
        </a>
        {% endfor %}
    </div>

    <!-- Pagination -->
    {% if pages > 1 %}
    <div class="mt-8 flex justify-center">
        <nav class="flex items-center gap-2">
            {% if page > 1 %}
            <a href="?page={{ page - 1 }}{% if current_type %}&type={{ current_type }}{% endif %}{% if current_status %}&status={{ current_status }}{% endif %}{% if search %}&search={{ search }}{% endif %}"
               class="px-3 py-2 bg-dark-800 hover:bg-dark-700 rounded-lg text-dark-300 transition-colors">
                Previous
            </a>
            {% endif %}

            <span class="px-4 py-2 text-dark-400">
                Page {{ page }} of {{ pages }}
            </span>

            {% if page < pages %}
            <a href="?page={{ page + 1 }}{% if current_type %}&type={{ current_type }}{% endif %}{% if current_status %}&status={{ current_status }}{% endif %}{% if search %}&search={{ search }}{% endif %}"
               class="px-3 py-2 bg-dark-800 hover:bg-dark-700 rounded-lg text-dark-300 transition-colors">
                Next
            </a>
            {% endif %}
        </nav>
    </div>
    {% endif %}

    {% else %}
    <!-- Empty State -->
    <div class="bg-dark-900 rounded-xl border border-dark-800 p-12 text-center">
        <div class="w-20 h-20 mx-auto bg-dark-800 rounded-full flex items-center justify-center mb-4">
            <svg class="w-10 h-10 text-dark-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"/>
            </svg>
        </div>
        {% if search or current_type or current_status %}
        <h2 class="text-xl font-semibold text-white mb-2">No results found</h2>
        <p class="text-dark-400 mb-6">Try adjusting your filters or search term.</p>
        <a href="/catalogue" class="text-primary-500 hover:text-primary-400">Clear all filters</a>
        {% else %}
        <h2 class="text-xl font-semibold text-white mb-2">Your library is empty</h2>
        <p class="text-dark-400 mb-6">Start adding films, books, or videos to your collection.</p>
        <a href="/add"
           class="inline-flex items-center justify-center px-6 py-3 bg-primary-600 hover:bg-primary-700 text-white font-medium rounded-lg transition-colors">
            <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"/>
            </svg>
            Add Your First Media
        </a>
        {% endif %}
    </div>
    {% endif %}
</div>
{% endblock %}
